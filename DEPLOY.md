# Инструкция по деплою

## Переменные окружения

### Сервер (.env в папке server)

```env
# MongoDB
MONGODB_URI="your_mongodb_connection_string"

# JWT
JWT_SECRET="your_jwt_secret_key"

# Порт сервера
PORT=3000

# Режим работыnp
NODE_ENV=production

# URL клиента (для CORS и Socket.IO)
CLIENT_URL=https://your-domain.com
```

### Клиент

В продакшене клиент автоматически использует относительные пути для всех API запросов и Socket.IO подключений.

## Настройки для деплоя

### 1. API URLs

Все API запросы используют относительные пути (`/api/...`), что позволяет работать как в разработке, так и в продакшене без изменений.

**Файлы:**
- `client/src/utils/config.js` - автоматически определяет продакшен и использует пустую строку для `API_BASE_URL`
- `client/src/services/*.service.js` - все используют относительные пути

### 2. Socket.IO

**Клиент:** `client/src/services/socket.service.js`
- В продакшене автоматически использует `window.location.origin`
- В разработке использует `API_BASE_URL` или `http://127.0.0.1:3000`

**Сервер:** `server/index.js`
- Настроен CORS для продакшена через `CLIENT_URL`
- Поддерживает WebSocket и polling транспорты

### 3. MongoDB

Все сообщения чата сохраняются в MongoDB через модели:
- `Chat` - чаты пользователей
- `Message` - сообщения в чатах

**Модели:** `server/modules/chat/chat.model.js`

### 4. Статические файлы

В продакшене сервер раздает статические файлы из `client/dist`:
- Все запросы, не начинающиеся с `/api`, перенаправляются на `index.html`
- Это позволяет React Router работать корректно

## Проверка после деплоя

1. **API запросы:** Проверьте, что все API запросы работают (авторизация, загрузка файлов, чат)
2. **Socket.IO:** Убедитесь, что WebSocket подключение устанавливается (проверьте консоль браузера)
3. **Чат:** Проверьте отправку и получение сообщений в реальном времени
4. **MongoDB:** Убедитесь, что сообщения сохраняются в базе данных

## Важные моменты

- Все ссылки автоматически адаптируются для продакшена
- Socket.IO использует текущий домен в продакшене
- MongoDB должна быть доступна из сервера
- CORS настроен для работы с указанным `CLIENT_URL`
